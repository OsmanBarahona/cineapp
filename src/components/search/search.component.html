<Page class="page">
    <ActionBar class="action-bar" title="Buscar PelÃ­culas">
        <ActionItem ios.position="right" android.position="actionBar">
            <Button text="Listado" (tap)="goToList()" class="btn btn-primary"></Button>
        </ActionItem>
    </ActionBar>

    <StackLayout class="p-4">
        <!-- Formulario de bÃºsqueda con two-way binding -->
        <TextField
            [(ngModel)]="searchQuery"
            hint="Buscar pelÃ­culas por tÃ­tulo, director o gÃ©nero..."
            class="input input-border"
            minLength="3"
            autocorrect="false"
            autocapitalizationType="none"
            (textChange)="onSearch()">
        </TextField>
        
        <Label *ngIf="searchQuery && searchQuery.length < 3" text="MÃ­nimo 3 caracteres" class="text-danger m-t-5"></Label>

        <!-- BotÃ³n con animaciÃ³n -->
        <Button text="Buscar" (tap)="onSearch()" class="btn btn-primary m-t-10"
                [class.btn-animated]="isSearching" (loaded)="onButtonLoaded($event)">
        </Button>

        <!-- ListView con Pull to Refresh -->
        <ListView [items]="filteredMovies" class="list-group m-t-20" (itemTap)="onMovieTap($event)"
                  pullToRefresh="true" (pullToRefreshInitiated)="onPullToRefresh($event)">
            
            <ng-template let-movie="item">
                <!-- Plantilla anidada con FlexboxLayout -->
                <FlexboxLayout class="list-group-item" flexDirection="row" alignItems="center">
                    
                    <!-- Imagen de la pelÃ­cula -->
                    <Image [src]="movie.imageUrl" class="thumb img-circle" 
                           stretch="aspectFill" width="80" height="80"></Image>
                    
                    <!-- Contenido principal -->
                    <StackLayout flexGrow="1" marginLeft="15">
                        <Label [text]="movie.title" class="h3"></Label>
                        <Label [text]="movie.director + ' (' + movie.year + ')'" class="body"></Label>
                        <FlexboxLayout flexDirection="row" justifyContent="space-between">
                            <Label [text]="movie.genre" class="badge"></Label>
                            <Label [text]="'â­ ' + movie.rating" class="rating"></Label>
                        </FlexboxLayout>
                    </StackLayout>
                    
                    <!-- Ãcono de favorito con gestos -->
                    <Label [text]="movie.isFavorite ? 'â¤ï¸' : 'ðŸ¤'" class="favorite-icon h2"
                           (tap)="toggleFavorite(movie)"
                           (doubleTap)="onDoubleTapFavorite(movie)"
                           [class.animated]="movie.isFavorite"></Label>
                    
                </FlexboxLayout>
            </ng-template>
            
        </ListView>
        
        <Label *ngIf="filteredMovies.length === 0 && searchQuery" 
               text="No se encontraron pelÃ­culas" class="h3 text-center m-t-20"></Label>
    </StackLayout>
</Page>